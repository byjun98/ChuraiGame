{% verbatim %}
<!-- Sale Tab -->
<div v-if="currentTab === 'sale'" class="animate-fade-in space-y-8">

    <!-- Popular Games ON SALE Section -->
    <section v-if="(popularGamesOnSale && popularGamesOnSale.length > 0) || isLoadingPopularGames">
        <div class="flex items-center gap-3 mb-4">
            <div
                class="w-10 h-10 bg-gradient-to-br from-yellow-500 to-red-500 rounded-xl flex items-center justify-center">
                <i class="ph-fill ph-crown text-white text-xl"></i>
            </div>
            <div>
                <h2 class="text-xl font-bold text-gray-800">ğŸ”¥ ì¸ê¸° ê²Œì„ ì„¸ì¼</h2>
                <p class="text-sm text-gray-500">RAWG ì¸ê¸° ê²Œì„ ì¤‘ í˜„ì¬ ì„¸ì¼ ì¤‘ì¸ ê²Œì„</p>
            </div>
        </div>

        <!-- Loading State -->
        <div v-if="isLoadingPopularGames" class="flex items-center justify-center py-8">
            <i class="ph-bold ph-spinner animate-spin text-2xl text-blue-500 mr-2"></i>
            <span class="text-gray-500">ì¸ê¸° ê²Œì„ ë§¤ì¹­ ì¤‘...</span>
        </div>

        <!-- Empty State -->
        <div v-else-if="!popularGamesOnSale || popularGamesOnSale.length === 0" class="text-center py-8 text-gray-500">
            <i class="ph-bold ph-magnifying-glass text-4xl mb-2"></i>
            <p>í˜„ì¬ ì„¸ì¼ ì¤‘ì¸ ì¸ê¸° ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤</p>
        </div>

        <!-- Horizontal Scroll with Arrow Buttons -->
        <div v-else class="relative min-h-[200px]">
            <!-- Left Arrow Button -->
            <button @click="scrollPopularGames('left')" v-show="popularGamesOnSale.length > 3"
                class="absolute left-0 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/90 hover:bg-white shadow-lg rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 -ml-2 sm:-ml-4 border border-gray-200">
                <i class="ph-bold ph-caret-left text-xl text-gray-700"></i>
            </button>

            <!-- Right Arrow Button -->
            <button @click="scrollPopularGames('right')" v-show="popularGamesOnSale.length > 3"
                class="absolute right-0 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/90 hover:bg-white shadow-lg rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 -mr-2 sm:-mr-4 border border-gray-200">
                <i class="ph-bold ph-caret-right text-xl text-gray-700"></i>
            </button>

            <!-- Popular Games List -->
            <div ref="popularGamesContainer"
                class="flex gap-4 overflow-x-auto pb-4 no-scrollbar scroll-smooth -mx-4 px-4 sm:mx-0 sm:px-0">
                <a v-for="(game, index) in infinitePopularGames" :key="'pop-' + game.rawg_id + '-' + index"
                    :href="`/games/${game.rawg_id}/`"
                    class="flex-shrink-0 w-72 bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl overflow-hidden relative group cursor-pointer hover:scale-[1.02] transition-transform">
                    <!-- Discount Badge -->
                    <div
                        class="absolute top-3 left-3 z-10 px-3 py-1 bg-red-500 text-white text-sm font-bold rounded-lg flex items-center gap-1 shadow-lg">
                        <i class="ph-fill ph-tag"></i>
                        -{{ Math.round(game.discount_rate * 100) }}%
                    </div>
                    <!-- Rating Badge -->
                    <div
                        class="absolute top-3 right-3 z-10 px-2 py-1 bg-yellow-500/90 text-white text-xs font-bold rounded-lg flex items-center gap-1">
                        <i class="ph-fill ph-star"></i>
                        {{ game.rating ? game.rating.toFixed(1) : 'N/A' }}
                    </div>
                    <div class="relative aspect-video">
                        <img :src="game.image_url || 'https://via.placeholder.com/460x215'" @error="handleImageError"
                            class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-4">
                        <h3 class="font-bold text-white text-sm line-clamp-1 mb-1">{{ game.title }}</h3>
                        <div class="flex items-center gap-2 text-xs text-gray-300 mb-2">
                            <span v-if="game.released">{{ game.released.substring(0, 4) }}</span>
                            <span v-if="game.genres && game.genres.length">â€¢ {{ game.genres[0] }}</span>
                            <span v-if="game.metacritic" class="px-1.5 py-0.5 rounded text-xs"
                                :class="game.metacritic >= 75 ? 'bg-green-500/80' : game.metacritic >= 50 ? 'bg-yellow-500/80' : 'bg-red-500/80'">
                                {{ game.metacritic }}
                            </span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-400 line-through">â‚©{{ formatPrice(game.original_price)
                                    }}</span>
                                <span class="text-lg font-bold text-green-400">â‚©{{ formatPrice(game.current_price)
                                    }}</span>
                            </div>
                            <div
                                class="w-8 h-8 rounded-full bg-white/10 text-white flex items-center justify-center group-hover:bg-white/20 transition-colors">
                                <i class="ph-bold ph-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Best Historical Prices Section -->
    <section v-if="bestPrices && bestPrices.length > 0">
        <div class="flex items-center gap-3 mb-4">
            <div
                class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                <i class="ph-fill ph-trophy text-white text-xl"></i>
            </div>
            <div>
                <h2 class="text-xl font-bold text-gray-800">ğŸ† ì—­ëŒ€ ìµœëŒ€ í• ì¸</h2>
                <p class="text-sm text-gray-500">ì—­ì‚¬ìƒ ê°€ì¥ ë†’ì€ í• ì¸ìœ¨ì„ ê¸°ë¡í•œ ê²Œì„ë“¤</p>
            </div>
        </div>

        <!-- Horizontal Scroll with Arrow Buttons -->
        <div class="relative min-h-[200px]">
            <!-- Left Arrow Button -->
            <button @click="scrollBestPrices('left')" v-show="bestPrices.length > 4"
                class="absolute left-0 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/90 hover:bg-white shadow-lg rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 -ml-2 sm:-ml-4 border border-gray-200">
                <i class="ph-bold ph-caret-left text-xl text-gray-700"></i>
            </button>

            <!-- Right Arrow Button -->
            <button @click="scrollBestPrices('right')" v-show="bestPrices.length > 4"
                class="absolute right-0 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/90 hover:bg-white shadow-lg rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 -mr-2 sm:-mr-4 border border-gray-200">
                <i class="ph-bold ph-caret-right text-xl text-gray-700"></i>
            </button>

            <!-- Best Prices List -->
            <div ref="bestPricesContainer"
                class="flex gap-4 overflow-x-auto pb-4 no-scrollbar scroll-smooth -mx-4 px-4 sm:mx-0 sm:px-0">
                <div v-for="(game, index) in infiniteBestPrices" :key="'best-' + game.game_id + '-' + index"
                    @click="navigateToGameByTitle($event, game.title, game.steam_app_id, game.cheapshark_url, game.rawg_id)"
                    class="flex-shrink-0 w-64 bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl overflow-hidden relative group cursor-pointer hover:scale-[1.02] transition-transform">
                    <!-- Best Price Badge -->
                    <div
                        class="absolute top-3 left-3 z-10 px-2 py-1 bg-purple-500 text-white text-xs font-bold rounded-lg flex items-center gap-1">
                        <i class="ph-fill ph-medal"></i>
                        ìµœëŒ€ -{{ Math.round(game.discount_rate * 100) }}%
                    </div>
                    <div class="relative aspect-video">
                        <img :src="game.thumbnail" @error="handleImageError" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-4">
                        <h3 class="font-bold text-white text-sm line-clamp-1 mb-2">{{ game.title }}</h3>
                        <div class="flex items-end justify-between">
                            <div>
                                <span class="text-xs text-gray-400 line-through block">â‚©{{
                                    formatPrice(game.original_price) }}</span>
                                <span class="text-lg font-bold text-purple-300">â‚©{{ formatPrice(game.current_price)
                                    }}</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-white/10 text-white flex items-center justify-center">
                                <i class="ph-bold ph-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Sale List -->
    <section>
        <div class="flex items-center justify-between mb-6 flex-wrap gap-3">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center">
                    <i class="ph-fill ph-tag text-white text-xl"></i>
                </div>
                <h2 class="text-xl font-bold">ğŸ’° í˜„ì¬ ì„¸ì¼ ì¤‘</h2>
            </div>

            <!-- Controls Container -->
            <div class="flex items-center gap-3 flex-wrap">
                <!-- Search Box -->
                <div class="relative">
                    <i class="ph-bold ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input v-model="saleSearchQuery" type="text" placeholder="ê²Œì„ ê²€ìƒ‰..."
                        class="bg-white border border-gray-200 text-sm rounded-lg pl-9 pr-3 py-2 w-40 sm:w-56 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                    <button v-if="saleSearchQuery" @click="saleSearchQuery = ''"
                        class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                        <i class="ph-bold ph-x text-sm"></i>
                    </button>
                </div>

                <!-- Items Per Page Dropdown -->
                <div class="flex items-center gap-2">
                    <span class="text-sm text-gray-500">í‘œì‹œ:</span>
                    <select v-model="saleItemsPerPage"
                        class="bg-white border border-gray-200 text-sm rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                        <option :value="12">12ê°œ</option>
                        <option :value="24">24ê°œ</option>
                        <option :value="36">36ê°œ</option>
                        <option :value="48">48ê°œ</option>
                    </select>
                </div>

                <!-- Sort Dropdown -->
                <select v-model="sortBy"
                    class="bg-white border border-gray-200 text-sm rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                    <option value="interest">ì¶”ì²œìˆœ</option>
                    <option value="rating">í‰ì ìˆœ</option>
                    <option value="discount">í• ì¸ìœ¨ìˆœ</option>
                    <option value="price_asc">ë‚®ì€ ê°€ê²©ìˆœ</option>
                </select>
            </div>
        </div>

        <!-- Games Count Info -->
        <div v-if="displayedSaleGames && sortedSaleGames" class="mb-4 text-sm text-gray-500">
            <span v-if="saleSearchQuery">
                "{{ saleSearchQuery }}" ê²€ìƒ‰ ê²°ê³¼: {{ sortedSaleGames.length }}ê°œ
                <span v-if="displayedSaleGames.length < sortedSaleGames.length">
                    ({{ displayedSaleGames.length }}ê°œ í‘œì‹œ ì¤‘)
                </span>
            </span>
            <span v-else>
                {{ displayedSaleGames.length }}ê°œ í‘œì‹œ ì¤‘ (ì „ì²´ {{ sortedSaleGames.length }}ê°œ)
            </span>
        </div>

        <!-- No Search Results -->
        <div v-if="saleSearchQuery && sortedSaleGames && sortedSaleGames.length === 0" class="text-center py-12">
            <i class="ph-bold ph-magnifying-glass text-5xl text-gray-300 mb-4"></i>
            <p class="text-gray-500 text-lg mb-2">"{{ saleSearchQuery }}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            <p class="text-gray-400 text-sm">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p>
            <button @click="saleSearchQuery = ''"
                class="mt-4 px-4 py-2 text-sm text-blue-600 hover:text-blue-700 hover:underline">
                ê²€ìƒ‰ ì´ˆê¸°í™”
            </button>
        </div>

        <div v-if="displayedSaleGames && displayedSaleGames.length > 0"
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div v-for="game in displayedSaleGames" :key="game.game_id"
                @click="navigateToGameByTitle($event, game.title, game.steam_app_id, game.cheapshark_url, game.rawg_id)"
                class="bg-white rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300 border border-gray-100 flex flex-col group relative cursor-pointer">
                <!-- Wishlist Button -->
                <button @click.stop.prevent="toggleWishlist(game)"
                    class="absolute top-3 left-3 z-10 w-8 h-8 rounded-full bg-black/30 backdrop-blur flex items-center justify-center transition-colors hover:bg-black/50">
                    <i class="ph-fill ph-heart text-lg transition-transform active:scale-75"
                        :class="isWishlisted(game.game_id) ? 'text-red-500' : 'text-white/70'"></i>
                </button>

                <div class="relative aspect-[16/9] bg-gray-200">
                    <img :src="game.thumbnail" @error="handleImageError" class="w-full h-full object-cover">
                    <div
                        class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-lg shadow-sm">
                        -{{ Math.round(game.discount_rate * 100) }}%
                    </div>
                </div>
                <div class="p-4 flex flex-col flex-1">
                    <h3 class="font-bold text-gray-800 mb-1 line-clamp-1" :title="game.title">{{ game.title }}</h3>
                    <!-- Steam Rating Badge -->
                    <div class="flex items-center gap-2 mb-2">
                        <span v-if="game.steam_rating"
                            class="px-2 py-0.5 rounded text-xs font-medium flex items-center gap-1"
                            :class="game.steam_rating >= 85 ? 'bg-green-100 text-green-700' : game.steam_rating >= 70 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'">
                            <i class="ph-fill ph-thumbs-up"></i>
                            {{ game.steam_rating }}%
                        </span>
                        <span v-if="game.review_count" class="text-xs text-gray-400">
                            ({{ formatReviewCount(game.review_count) }}ê°œ ë¦¬ë·°)
                        </span>
                        <span v-if="game.is_historical_low"
                            class="px-2 py-0.5 rounded text-xs font-bold bg-red-500 text-white animate-pulse">
                            ğŸ”¥ ì—­ëŒ€ ìµœì €ê°€!
                        </span>
                    </div>
                    <div class="mt-auto pt-3 flex items-end justify-between">
                        <div class="flex flex-col">
                            <span class="text-xs text-gray-400 line-through">â‚©{{ formatPrice(game.original_price)
                                }}</span>
                            <span class="text-lg font-bold text-blue-600">â‚©{{ formatPrice(game.current_price) }}</span>
                        </div>
                        <!-- Buttons -->
                        <div class="flex items-center gap-1">
                            <!-- Compare Prices Button (CheapShark) -->
                            <a v-if="game.cheapshark_url" :href="game.cheapshark_url" target="_blank" @click.stop
                                class="w-8 h-8 rounded-full bg-purple-50 hover:bg-purple-100 text-purple-600 flex items-center justify-center transition-colors"
                                title="ê°€ê²© ë¹„êµ / ë‹¤ë¥¸ ìŠ¤í† ì–´ì—ì„œ ë³´ê¸°">
                                <i class="ph-bold ph-storefront"></i>
                            </a>
                            <!-- Steam Button -->
                            <a :href="game.store_link" target="_blank" @click.stop
                                class="w-8 h-8 rounded-full bg-gray-50 hover:bg-gray-100 text-gray-600 flex items-center justify-center transition-colors"
                                title="Steamì—ì„œ ë³´ê¸°">
                                <i class="ph-bold ph-steam-logo"></i>
                            </a>
                            <!-- Detail Arrow -->
                            <div
                                class="w-8 h-8 rounded-full bg-gray-50 group-hover:bg-blue-50 text-gray-400 group-hover:text-blue-600 flex items-center justify-center transition-colors">
                                <i class="ph-bold ph-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Load More Button (Alternative to Infinite Scroll) -->
        <div class="flex justify-center mt-8">
            <button v-if="sortedSaleGames && hasMoreSaleGames && !isLoadingMoreSales"
                @click="currentSaleCount += saleItemsPerPage"
                class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg transition-all duration-300 hover:scale-105 flex items-center gap-2">
                <i class="ph-bold ph-plus"></i>
                ë” ë³´ê¸° ({{ Math.min(saleItemsPerPage, sortedSaleGames.length - displayedSaleGames.length) }}ê°œ)
            </button>
            <div v-else-if="isLoadingMoreSales" class="flex items-center gap-2 text-gray-500">
                <i class="ph-bold ph-spinner animate-spin"></i>
                <span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
            </div>
            <div v-else class="text-gray-400 text-sm py-4">
                âœ… ëª¨ë“  ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤ ({{ sortedSaleGames.length }}ê°œ)
            </div>
        </div>
    </section>

    <!-- Scroll to Top Button -->
    <button v-show="showScrollTopBtn" @click="scrollToTop"
        class="fixed bottom-24 right-6 z-50 w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center hover:scale-110 active:scale-95"
        style="animation: fadeInUp 0.3s ease-out;">
        <i class="ph-bold ph-arrow-up text-xl"></i>
    </button>
</div>
{% endverbatim %}